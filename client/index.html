<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="d3.v5.min.js"></script>
  <style>
    rect {
      fill: white;
      stroke: black;
      stroke-width: 1;
    }
    
    path {
      fill: none;
      stroke: black;
      stroke-width: 1;
    }
  </style>
</head>

<body>
  <script>
const W = 960;
const H = 500;
const M = 30;

  var svg = d3.select("body").append("svg")
    .attr("width", W)
    .attr("height", H);

    var y = d3.scaleLinear()
    	.domain([0, 1000])
    	.range([H-M, M]);
    y.ticks(10)

    var yaxis = d3.axisLeft(y)
      .ticks(10)
      svg.append("g")
      .attr("transform", "translate(30,0)")
      .call(yaxis)
    
  var x = d3.scaleTime()
    	.range([M, W-M]);
    
    var xaxis = d3.axisTop(x)
      .ticks(d3.timeMinute.every(30));
    
    var xaxis_group = svg.append("g")
    .attr("transform", "translate(0,"+(H-M)+")")
  
    var line = d3.line()
     .x(function(d, i) {
        let _x =  x(new Date(d.time)); 
        return _x;
     })
     .y(function(d) {
       let _y = y(+d.temperature)
       return _y; 
     });

    //reference line
    svg.append("line")
    .attr("x1", M)
    .attr("y1", H-M)
    .attr("x2", W-M)
    .attr("y2", M)
    .attr("stroke", "green");

function update()
  {
    d3.json("./data").then(data => 
    {
      refresh(data) 
      setTimeout(update, 1000);
    });
  } 

    function refresh(data)
    {
    
    let mindate = new Date(data[0].time);
    let maxdate = new Date(data[data.length-1].time);

    // ordinal
    x.domain([mindate, maxdate]);
    xaxis_group.call(xaxis);
 
		var s = svg.selectAll("path#datos").data([data]).enter()
    	.append("path")
      .attr("id", "datos")
    	.attr("d", function(d) {   
        let l = line(d); 
        console.log(l);
        return l;
      })

    }
    
update()
  </script>
</body>
